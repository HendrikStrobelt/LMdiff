import{j as e,d as t,r as n,a as o,w as a,e as l,l as i,b as s,p as r,c as d,f as c,s as u,g as p,h,i as m,k as f,m as g,v,F as b,n as k,o as y,q as x,t as w,u as M,x as T,y as S,z as C,A as _,B as I,C as z,D as A,E as D,G as L,T as H,H as R,I as E,J as q,K as P,L as N,M as $,N as O,O as j,P as U}from"./vendor.e00d9c49.js";function B(e,t){if(t){let n=e+"?";return Object.keys(t).forEach((e=>{n+=encodeURIComponent(e),n+="=",n+=encodeURIComponent(t[e]),n+="&"})),n.replace(/&$/g,"")}return e}class F{constructor(e=null,t="/api"){const n=null==t?"":t,o=null==e?function(){const e=window.location.pathname.split("/").slice(0,-2).join("/");return window.location.origin+(e.length?e:"")}():e;this.baseURL=o+n}all_projects(){return e(this.baseURL+"/all-models")}all_ds(t=null,n=null){const o=B(this.baseURL+"/available-datasets",{m1:t,m2:n});return e(o)}findSamples(t,n,o,a,l="descending",i=50){const s={m1:t,m2:n,dataset:o,metric:a,order:l,k:i,histogram_bins:30};return e(B(this.baseURL+"/new-suggestions",s))}getSpecificAttentions(t,n,o,a){const l={m1:t,m2:n,text:o,token_index_in_text:a};return e(this.baseURL+"/specific-attention",(i=l,{method:"POST",body:JSON.stringify(i),headers:{"Content-type":"application/json; charset=UTF-8"}}));var i}analyze(t,n,o){const a={m1:t,m2:n,text:o};return e(this.baseURL+"/analyze-text",{method:"POST",body:JSON.stringify(a),headers:{"Content-type":"application/json; charset=UTF-8"}})}}F.isDemo=!!{}.VITE_IS_DEMO;var V=t({name:"LineGraph",props:{values:{type:Array,required:!0},maxValue:{type:Number,default:Number.MAX_VALUE},yScale:{type:Function,default:null},showHoverFor:{type:Number,default:-1}},emits:["hoverChanged"],setup(e,t){const m=n(null),f=n(null),g=n(null),v=o({width:100,height:80}),b=n(5),k={l:40,b:25,r:5,t:5};let y=n((e=>{}));const x=n([]);return a((()=>e.values),(n=>{console.log("watch--- ");const o=n?n[0].length:0;b.value=o<30?15:o<60?8:5;const a=o*b.value,[g,w]=l(i.exports.flatten(n));v.width=k.l+k.r+a;const M=e.yScale?e.yScale:s();M.domain([Math.min(0,g),Math.min(w,e.maxValue)]).range([v.height-k.b,k.t]);const T=s().domain([0,o]).range([k.l,k.l+a]);y.value=e=>{const[n,o]=r(e),a=Math.floor(T.invert(n));t.emit("hoverChanged",{index:a})};const S=d().x(((e,t)=>T(t)+.5*b.value)).y((e=>M(e))).curve(c);x.value=n.map(((e,t)=>{return{d:S(e),stroke:(n=t,["#d6604d","#4393c3"][n%2])};var n})),u(m.value).call(p(T)).attr("transform",`translate(0,${v.height-k.b})`),u(f.value).call(h(M).ticks(Math.floor(v.height/20))).attr("transform",`translate(${k.l},0)`)})),{svgDims:v,linedata:x,xAxisRef:m,yAxisRef:f,hoverTrigger:g,intents:k,triggerMove:y,stepSize:b,hoverOut:()=>{t.emit("hoverChanged",-1)}}}});const W=y();x("data-v-0ee3306f");const G={ref:"xAxisRef"},J={ref:"yAxisRef"},K={class:"lines"};w();const Z=W(((e,t,n,o,a,l)=>(M(),m("svg",{class:"LineGraph",width:e.svgDims.width,height:e.svgDims.height},[f("g",G,null,512),f("g",J,null,512),g(f("rect",{class:"hoverBar",x:e.showHoverFor*e.stepSize+e.intents.l,y:e.intents.t,height:e.svgDims.height-e.intents.t-e.intents.b,width:e.stepSize},null,8,["x","y","height","width"]),[[v,e.showHoverFor>=0]]),f("g",K,[(M(!0),m(b,null,k(e.linedata,(e=>(M(),m("path",{class:"line",d:e.d,style:{stroke:e.stroke}},null,12,["d"])))),256))]),f("rect",{ref:"hoverTrigger",x:e.intents.l,y:e.intents.t,width:e.svgDims.width-e.intents.l-e.intents.r,height:e.svgDims.height-e.intents.t-e.intents.b,class:"hoverTrigger",onMousemove:t[1]||(t[1]=(...t)=>e.triggerMove&&e.triggerMove(...t)),onMouseout:t[2]||(t[2]=(...t)=>e.hoverOut&&e.hoverOut(...t))},null,40,["x","y","width","height"])],8,["width","height"]))));V.render=Z,V.__scopeId="data-v-0ee3306f";const X='<svg xmlns="http://www.w3.org/2000/svg"\n             viewBox="0 0 32 32">\n          <path\n              d="M16,2A14,14,0,1,0,30,16,14,14,0,0,0,16,2Zm0,26A12,12,0,1,1,28,16,12,12,0,0,1,16,28Z"/>\n          <circle cx="16" cy="23.5" r="1.5"/>\n          <path\n              d="M17,8H15.5A4.49,4.49,0,0,0,11,12.5V13h2v-.5A2.5,2.5,0,0,1,15.5,10H17a2.5,2.5,0,0,1,0,5H15v4.5h2V17a4.5,4.5,0,0,0,0-9Z"/>\n        </svg>';var Q=t({name:"NavBar",props:{allModels:Array,selectedM1:String,selectedM2:String},emits:["update:selectedM1","update:selectedM2","aboutClicked"],setup:(e,t)=>({emitValue:(e,n)=>{t.emit(e,n.target.value)},questionMark:X})});const Y=y();x("data-v-3b2c0ea8");const ee={class:"header"},te={class:"headertext"},ne=f("span",{style:{"font-weight":"bold"}},"LMdiff",-1),oe={class:"headertext"},ae={style:{"background-color":"#d6604d",padding:"2px 5px","white-space":"nowrap"}},le=f("label",{for:"m1_select"},"model1:",-1),ie=T("  "),se={style:{"background-color":"#4393c3",padding:"2px 5px","white-space":"nowrap"}},re=f("label",{for:"m2_select"},"model2:",-1);w();const de=Y(((e,t,n,o,a,l)=>(M(),m("div",ee,[f("div",te,[ne,f("div",{style:{padding:"3pt",display:"inline-block","vertical-align":"baseline",cursor:"pointer"},onClick:t[1]||(t[1]=t=>e.$emit("aboutClicked"))},[(M(),m("svg",{class:"question-icon",innerHTML:e.questionMark},null,8,["innerHTML"]))])]),f("div",oe,[f("span",ae,[le,f("select",{id:"m1_select",value:e.selectedM1,onInput:t[2]||(t[2]=t=>e.emitValue("update:selectedM1",t))},[(M(!0),m(b,null,k(e.allModels,(e=>(M(),m("option",{value:e.model,key:e.model},S(e.type)+" -"+S(e.model),9,["value"])))),128))],40,["value"])]),ie,f("span",se,[re,f("select",{id:"m2_select",value:e.selectedM2,onInput:t[3]||(t[3]=t=>e.emitValue("update:selectedM2",t))},[(M(!0),m(b,null,k(e.allModels,(e=>(M(),m("option",{value:e.model,key:e.model},S(e.type)+" -"+S(e.model),9,["value"])))),128))],40,["value"])])])]))));Q.render=de,Q.__scopeId="data-v-3b2c0ea8";const ce=C().exponent(.3).domain([-1,0,1]).range(["#d6604d","#f7f7f7","#4393c3"]),ue=s(),pe=C().exponent(.3).domain([0,1]).range(["#f7f7f7","#808080"]),he=s(),me=_().domain([10,100,1e3]).range(["#ffffff","#dddddd","#aaa","#777"]),fe=me.copy().range(["0-10","10-100","100-1000","1000-"]),ge=_().domain([-100,-10,-1,1,10,100]).range(["#5299cc","#8fb3cc","#b8c4cc","#ffffff","#dbc5c5","#d49d94","#d6604d"]),ve=ge.copy().domain([-30,-10,-1,1,10,30]),be=ge.copy().range(["<-100","-100 > -10","-10 > -1","-1 > 1","1 > 10","10 > 100",">100"]),ke=ve.copy().range(["<-50","-100 > -10","-10 > -1","-1 > 1","1 > 10","10 > 100",">50"]),ye=C().exponent(1).domain([0,10]).range(["#fff","#333"]),xe={diff:{discrete:!1,colorScale:ce,valueScale:ue,name:"Probability Diff",description:"Difference of predicted probabilities: prob(M2) - prob(M1)",diff:[ce(-.5),ce(.5)],access:"diff.prob"},prob_m1:{discrete:!1,colorScale:pe,valueScale:he,name:"Probability M1",description:"Predicted probabilities under model M1",access:"m1.prob"},prob_m2:{discrete:!1,colorScale:pe,valueScale:he,name:"Probability M2",description:"Predicted probabilities under model M2",access:"m2.prob"},rank_m1:{discrete:!0,colorScale:me,valueScale:fe,name:"Rank M1",description:"Predicted rank under model M1",access:"m1.rank"},rank_m2:{discrete:!0,colorScale:me,valueScale:fe,name:"Rank M2",description:"Predicted rank under model M2",access:"m2.rank"},rank_diff:{discrete:!0,reverse:!0,colorScale:ge,valueScale:be,name:"Rank Diff",description:"Difference of predicted rank: rank(M2) - rank(M1)",access:"diff.rank"},rank_diff_clamped:{discrete:!0,reverse:!0,colorScale:ve,valueScale:ke,name:"Clamped Rank Diff",description:"Difference of predicted rank clamped to 50: min(rank(M2),50) - min(rank(M1),50)",access:"diff.rank_clamp"},topk_intersect:{discrete:!0,reverse:!1,colorScale:ye,valueScale:pe,name:"Top10 Diff",description:"10 - (Size of intersection set of top 10 terms)",access:"diff.topk"}},we={gpt:{type:"gpt",leftSpace:e=>e.startsWith("Ġ"),newLine:e=>e.startsWith("Ċ"),cleanup:e=>Me(e=(e=(e=e.startsWith("Ġ")?e.slice(1):e.startsWith("Ċ")||e.startsWith("â")?" ":e).replace("ÃŁ","ß")).replace("Ã¶","ö"))},bert:{type:"bert",leftSpace:e=>!e.startsWith("##"),newLine:e=>!1,cleanup:e=>Me(e=e.startsWith("##")?e.slice(2):e)}};function Me(e){try{e=decodeURIComponent(escape(e))}catch{console.log(e,"-- token is hard")}return e}var Te=t({name:"TooltipContent",props:{currentTokenInfo:{type:Object},tokenization:{type:Object,default:we.gpt},showMiniTT:{type:Boolean,default:!1}},setup:(e,t)=>({conditionalColor:(e,t=!0)=>t?e>0?"#d6604d":e<0?"#4393c3":null:e>0?"#4393c3":e<0?"#d6604d":null,formatNumbers:I(".3f")})});const Se=y();x("data-v-0dc8a9d9");const Ce={class:"TooltipContent"},_e={key:0,class:"tooltipSub"},Ie={class:"tt-c"},ze={class:"tt-c"},Ae={class:"tt-c"},De=T("ΔProb: "),Le=T("ΔRank: "),He=T("ΔRankCl: "),Re=T("ΔTop10: "),Ee={style:{"text-align":"center"}},qe={style:{"font-weight":"bold",padding:"3px 0"}};w();const Pe=Se(((e,t,n,o,a,l)=>{var i,s,r,d,c,u,p,h,y,x,w,T,C,_,I,A,D,L,H,R,E,q,P,N,$,O,j,U,B,F;return M(),m("div",Ce,[e.showMiniTT?z("",!0):(M(),m("div",_e,[g(f("div",Ie,[f("div",null," Prob: "+S(e.formatNumbers(null==(s=null==(i=e.currentTokenInfo)?void 0:i.m1)?void 0:s.prob)),1),f("div",null," Rank: "+S((null==(d=null==(r=e.currentTokenInfo)?void 0:r.m1)?void 0:d.rank)+1),1),(M(!0),m(b,null,k((null==(u=null==(c=e.currentTokenInfo)?void 0:c.m1)?void 0:u.topk)||[],(t=>(M(),m("div",{style:[{color:"#d6604d"},{fontWeight:t[0]===e.currentTokenInfo.token?"bold":null}]},S(e.formatNumbers(t[1]))+" - "+S(e.tokenization.cleanup(t[0])),5)))),256))],512),[[v,!!(null==(p=e.currentTokenInfo)?void 0:p.m1)]]),g(f("div",ze,[f("div",null," Prob: "+S(e.formatNumbers(null==(y=null==(h=e.currentTokenInfo)?void 0:h.m2)?void 0:y.prob)),1),f("div",null," Rank: "+S((null==(w=null==(x=e.currentTokenInfo)?void 0:x.m2)?void 0:w.rank)+1),1),(M(!0),m(b,null,k((null==(C=null==(T=e.currentTokenInfo)?void 0:T.m2)?void 0:C.topk)||[],(t=>(M(),m("div",{style:[{color:"#4393c3"},{fontWeight:t[0]===e.currentTokenInfo.token?"bold":null}]},S(e.formatNumbers(t[1]))+" - "+S(e.tokenization.cleanup(t[0])),5)))),256))],512),[[v,!!(null==(_=e.currentTokenInfo)?void 0:_.m2)]]),g(f("div",Ae,[f("div",null,[De,f("span",{style:{color:e.conditionalColor(null==(A=null==(I=e.currentTokenInfo)?void 0:I.diff)?void 0:A.prob,!1)}},S(e.formatNumbers(null==(L=null==(D=e.currentTokenInfo)?void 0:D.diff)?void 0:L.prob)),5)]),f("div",null,[Le,f("span",{style:{color:e.conditionalColor(null==(R=null==(H=e.currentTokenInfo)?void 0:H.diff)?void 0:R.rank)}},S(null==(q=null==(E=e.currentTokenInfo)?void 0:E.diff)?void 0:q.rank),5)]),f("div",null,[He,f("span",{style:{color:e.conditionalColor(null==(N=null==(P=e.currentTokenInfo)?void 0:P.diff)?void 0:N.rank_clamped)}},S(null==(O=null==($=e.currentTokenInfo)?void 0:$.diff)?void 0:O.rank_clamped),5)]),f("div",null,[Re,f("span",null,S(null==(U=null==(j=e.currentTokenInfo)?void 0:j.diff)?void 0:U.topk),1)])],512),[[v,!!(null==(B=e.currentTokenInfo)?void 0:B.diff)]])])),f("div",Ee,[f("div",qe,S(e.tokenization.cleanup(null==(F=e.currentTokenInfo)?void 0:F.token)),1)])])}));Te.render=Pe,Te.__scopeId="data-v-0dc8a9d9";var Ne=t({name:"InteractiveTokens",components:{TooltipContent:Te},props:{tokens:{type:Array,required:!0},tokenization:{type:Object,default:we.gpt},showHoverFor:{type:Number,default:-1},showMiniTT:{type:Boolean,default:!1},areSelected:{type:Array,default:[]}},emits:["hoverChanged","tokenClicked"],setup(e,t){const l=o({rightAligned:!1,x:-1,y:-1,visible:!1});let s=[];A((()=>{s=[]}));const r=n(null),d=i.exports.throttle((t=>{if(t<0)l.visible=!1;else{const n=s[t].getBoundingClientRect();n.left<window.innerWidth/2?(l.x=n.left,l.rightAligned=!1):(l.x=window.innerWidth-n.right,l.rightAligned=!0),l.y=n.bottom+5,l.visible=!0,r.value=e.tokens[t]}}),100,{leading:!1});a((e=>e.showHoverFor),(e=>{d(e)}));return D((()=>{s.forEach((e=>{}))})),{mouseEnter:(e,n)=>{t.emit("hoverChanged",{index:e})},mouseLeave:()=>{t.emit("hoverChanged",{index:-1})},mouseClicked:e=>{t.emit("tokenClicked",{index:e})},tt:l,currentTokenInfo:r,addTokenRef:e=>{s.push(e)}}}});const $e=y();x("data-v-19ca6734");const Oe={class:"InteractiveTokens"};w();const je=$e(((e,t,n,o,a,l)=>{const i=L("TooltipContent");return M(),m("div",Oe,[(M(!0),m(b,null,k(e.tokens,((n,o)=>(M(),m("div",{class:["token",{leftSpace:e.tokenization.leftSpace(n.token),newLine:e.tokenization.newLine(n.token)}],ref:e.addTokenRef,key:o,style:{borderBottom:"5px solid",backgroundColor:o===e.showHoverFor?n.color:e.areSelected.includes(o)?"#ccc":null,borderTop:"4px solid",borderBottomColor:o===e.showHoverFor?e.areSelected.includes(o)?"#ccc":"#333":n.color,borderTopColor:e.areSelected.includes(o)?"#ccc":o===e.showHoverFor?"#333":"rgba(0,0,0,0)"},onMouseenter:t=>e.mouseEnter(o,t),onMouseleave:t[1]||(t[1]=(...t)=>e.mouseLeave&&e.mouseLeave(...t)),onClick:t=>e.mouseClicked(o)},S(e.tokenization.cleanup(n.token)),47,["onMouseenter","onClick"])))),128)),e.tt.visible?(M(),m("div",{key:0,class:"tooltip",style:{top:e.tt.y+"px",left:e.tt.rightAligned?null:e.tt.x+"px",right:e.tt.rightAligned?e.tt.x+"px":null,borderRadius:e.tt.rightAligned?"20px 0px 20px 20px":"0 20px 20px 20px"}},[f(i,{"current-token-info":e.currentTokenInfo,tokenization:e.tokenization,showMiniTT:e.showMiniTT},null,8,["current-token-info","tokenization","showMiniTT"])],4)):z("",!0)])}));Ne.render=je,Ne.__scopeId="data-v-19ca6734";var Ue=t({name:"MultiSelectTooltips",components:{TooltipContent:Te},props:{tooltipList:{type:Array},showHoverFor:{type:Number,default:-1}},emits:["closeTT","hoverChanged"],setup:(e,t)=>({closeTT:e=>{t.emit("closeTT",{index:e})},mouseEnter:e=>{console.log(e,"--- index"),t.emit("hoverChanged",{index:e,mini:!0})}})});const Be=y();x("data-v-3abfd762");const Fe={class:"MultiSelectTooltips"},Ve={style:{display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"space-between",padding:"0 5px"}};w();const We=Be(((e,t,n,o,a,l)=>{const i=L("TooltipContent");return M(),m("div",Fe,[f(H,{name:"fade"},{default:Be((()=>[(M(!0),m(b,null,k(e.tooltipList,(n=>(M(),m("div",{class:"tooltip",key:n.index,onMouseenter:t=>e.mouseEnter(n.index),onMouseleave:t[1]||(t[1]=t=>e.mouseEnter(-1)),style:{borderColor:n.index===e.showHoverFor?"#999":null}},[f("div",Ve,[f("div",null,"index "+S(n.index),1),f("button",{onClick:t=>e.closeTT(n.index)},"X",8,["onClick"])]),f(i,{tokenization:n.tokenization,"current-token-info":n.currentTokenInfo},null,8,["tokenization","current-token-info"])],44,["onMouseenter"])))),128))])),_:1})])}));Ue.render=We,Ue.__scopeId="data-v-3abfd762";const Ge=[{k:"avg_rank_diff",d:"Average Rank Diff",t:"rank"},{k:"max_rank_diff",d:"Maximum Rank Diff",t:"rank"},{k:"avg_clamped_rank_diff",d:"Average Clamped 50 Rank Diff",t:"rank"},{k:"max_clamped_rank_diff",d:"Maximum Clamped 50 Rank Diff",t:"rank"},{k:"avg_prob_diff",d:"Average Probability Diff",t:"prob"},{k:"max_prob_diff",d:"Maximum Probability Diff",t:"prob"},{k:"avg_topk_diff",d:"Average TopK List Diff",t:"topk"},{k:"max_topk_diff",d:"Maximum TopK List Diff",t:"topk"}];const Je=["rgb(67, 147, 195)","#eee","rgb(214, 96, 77)"],Ke=["rgb(214, 96, 77)","#eee","rgb(67, 147, 195)"];var Ze=t({name:"MiniHisto",props:{dataPoints:{type:Array,default:[]},lowerThreshold:{type:Number,default:-.01},upperThreshold:{type:Number,default:.01},colorScheme:{type:Array,default:Ke},height:{type:Number,default:150},width:{type:Number,default:200}},setup(e,t){const o={width:e.width,height:e.height},a={l:45,r:5,b:22,t:5},l=n(null),i=n(null),r=n(null),d=n([]),c=n([]),p=()=>{const t=e.lowerThreshold,n=e.upperThreshold,l=[[],[],[]];e.dataPoints.forEach((e=>{e<t?l[0].push(e):e>n?l[2].push(e):l[1].push(e)}));const i=[`x<${t}`,`${t} <= x <= ${n}`,`x>${n} `],p=l.map(((t,n)=>({l:t.length,label:i[n],color:e.colorScheme[n]})));0==p[1].l&&p.splice(1,1);const m=s().domain([0,q(p.map((e=>e.l)))]).range([o.height-a.t-a.b,0]),f=s().domain([0,p.length]).range([0,o.width-a.l-a.r]);d.value=p.map(((e,t)=>({x:f(t),y:m(e.l),w:f(1)-f(0),h:o.height-a.t-a.b-m(e.l),label:`${e.label} [${e.l}]`,color:e.color}))),c.value=p.map(((e,t)=>({x:f(t+.5),y:t%2*10,label:e.label}))),u(r.value).call(h(m))};return R((()=>{p()})),E((()=>{p()})),{size:o,margin:a,mainPlot:l,xAxis:i,yAxis:r,bars:d,xLabels:c}}});const Xe=y()(((e,t,n,o,a,l)=>(M(),m("svg",{width:e.size.width,height:e.size.height,class:"MiniHisto"},[f("g",{class:"xAxis axis",ref:"xAxis",transform:`translate(${e.margin.l}, ${e.size.height-e.margin.b})`},[(M(!0),m(b,null,k(e.xLabels,((e,t)=>(M(),m("text",{class:"xLabel",x:e.x,y:e.y,style:{"text-anchor":"middle","alignment-baseline":"hanging",fill:"currentColor"}},S(e.label),9,["x","y"])))),256))],8,["transform"]),f("g",{class:"yAxis axis",ref:"yAxis",transform:`translate(${e.margin.l}, ${e.margin.t})`},null,8,["transform"]),f("g",{ref:"mainPlot",transform:`translate(${e.margin.l}, ${e.margin.t})`},[(M(!0),m(b,null,k(e.bars,(e=>(M(),m("rect",{class:"bar",x:e.x,y:e.y,width:e.w,height:e.h,style:{fill:e.color?e.color:null}},null,12,["x","y","width","height"])))),256))],8,["transform"])],8,["width","height"]))));Ze.render=Xe,Ze.__scopeId="data-v-49f38ed7";var Qe=t({name:"MidiHistogram",props:{values:{type:Array,required:!0},binEdges:{type:Array,required:!0},colorScheme:{type:Array,default:Ke},height:{type:Number,default:150},width:{type:Number,default:200},usedValues:{type:Array,default:[]}},setup(e,t){const o={width:e.width,height:e.height},i={l:45,r:5,b:22,t:5},r=n([]),d=n([]),c=n(null),m=n(null),f=n(null),g=n(-1),v=()=>{const t=s().domain([0,e.binEdges.length]).range([0,o.width-i.l-i.r]),n=s().domain([0,Math.max(...e.values)]).range([o.height-i.b-i.t,0]),a=Math.max(-e.binEdges[0],e.binEdges[e.binEdges.length-1]),f=s().domain([-a,0,a]).range(e.colorScheme),g=s().domain(l(e.binEdges)).range([0,o.width-i.l-i.r]);u(c.value).call(p(g).ticks(3)),u(m.value).call(h(n)),d.value=e.usedValues.map((e=>g(e))),r.value=e.values.map(((a,l)=>({x:t(l),y:n(a),w:t(1)-t(0),h:o.height-i.t-i.b-n(a),label:`${a} [${e.binEdges[l]}, ${e.binEdges[l+1]}]`,color:f(.5*(e.binEdges[l]+e.binEdges[l+1]))})))};a((e=>[e.values,e.binEdges]),(()=>{v()})),E((()=>{v()}));let b=[];return D((()=>{b.forEach((e=>e.destroy()));const e=u(f.value).selectAll("[data-tippy-content]").nodes();b=P(e,{trigger:"mouseenter"})})),R((()=>{console.log(g.value,"--- highlightIndex.value")})),{size:o,margin:i,xAxis:c,yAxis:m,bars:r,myself:f,highlightIndex:g,samples:d}}});const Ye=y()(((e,t,n,o,a,l)=>(M(),m("svg",{width:e.size.width,height:e.size.height,class:"MidiHistogram",ref:"myself"},[f("g",{class:"yAxis axis",ref:"yAxis",transform:`translate(${e.margin.l}, ${e.margin.t})`},null,8,["transform"]),f("g",{transform:`translate(${e.margin.l}, ${e.margin.t})`},[(M(!0),m(b,null,k(e.bars,((n,o)=>(M(),m("rect",{class:"highlighter",x:n.x,y:0,width:n.w,height:e.size.height-e.margin.t,"data-tippy-content":n.label,onMouseover:t=>e.highlightIndex=o,onMouseout:t[1]||(t[1]=t=>e.highlightIndex=-1)},null,40,["x","width","height","data-tippy-content","onMouseover"])))),256)),(M(!0),m(b,null,k(e.bars,((t,n)=>(M(),m("rect",{class:["bar",{highlighted:n===e.highlightIndex}],x:t.x,y:t.y,width:t.w,height:t.h,style:{fill:t.color?t.color:null}},null,14,["x","y","width","height"])))),256))],8,["transform"]),f("g",{transform:`translate(${e.margin.l}, ${e.margin.t})`,class:"sample"},[(M(!0),m(b,null,k(e.samples,(t=>(M(),m("line",{x1:t,x2:t,y1:(e.size.height-e.margin.t-e.margin.b)/2-10,y2:(e.size.height-e.margin.t-e.margin.b)/2+10},null,8,["x1","x2","y1","y2"])))),256))],8,["transform"]),f("g",{class:"xAxis axis",ref:"xAxis",transform:`translate(${e.margin.l}, ${e.size.height-e.margin.b+3})`},null,8,["transform"])],8,["width","height"]))));Qe.render=Ye,Qe.__scopeId="data-v-b96b2880";var et=t({name:"App",components:{MidiHistogram:Qe,MultiSelectTooltips:Ue,InteractiveTokens:Ne,LineGraph:V,NavBar:Q,MiniHisto:Ze},setup(){const e=o({analyzeRequestSent:!1,zeroRequests:!0,searchRequestSent:!1,modelsMatch:!1,showAbout:F.isDemo,showSearch:!0,showEnter:!0,analytics:F.isDemo}),t=new F,l=n([]),s=n(""),r=n(""),d=n([]),c=n([]),u=n(-1),p=n(we.gpt);let h=null;const m=i.exports.sortBy(Object.entries(xe).map((([e,t])=>({key:e,name:t.name,description:t.description}))),["key"]),f=n("rank_diff_clamped"),g=n(xe[f.value]),v=n([]),b=n(""),k=n("avg_clamped_rank_diff"),y=n({}),x=n([]),w=n(!1),M=n([]),T=n("The dominant sequence transduction models are based on complex recurrent or convolutional neural networks in an encoder-decoder configuration. The best performing models also connect the encoder and decoder through an attention mechanism. We propose a new simple network architecture, the Transformer, based solely on attention mechanisms, dispensing with recurrence and convolutions entirely. Experiments on two machine translation tasks show these models to be superior in quality while being more parallelizable and requiring significantly less time to train. Our model achieves 28.4 BLEU on the WMT 2014 English-to-German translation task, improving over the existing best results, including ensembles by over 2 BLEU. On the WMT 2014 English-to-French translation task, our model establishes a new single-model state-of-the-art BLEU score of 41.8 after training for 3.5 days on eight GPUs, a small fraction of the training costs of the best models from the literature. We show that the Transformer generalizes well to other tasks by applying it successfully to English constituency parsing both with large and limited training data.");t.all_projects().then((e=>{l.value=e,e.length>1&&(s.value=e[0].model,r.value=e[1].model)})),R((()=>{const n=l.value.filter((e=>e.model==s.value))[0],o=l.value.filter((e=>e.model==r.value))[0];e.modelsMatch=!!s.value&&!!r.value&&n.type===o.type,e.modelsMatch&&(p.value=we[n.token],e.zeroRequests=!0),t.all_ds(s.value,r.value).then((e=>{v.value=e,e.length>0&&(b.value=e[0]),z.value=[]}))}));const S=()=>{M.value=[],e.analyzeRequestSent=!0,e.zeroRequests=!1,t.analyze(s.value,r.value,T.value).then((t=>{e.analyzeRequestSent=!1,h=t,_();const n=t.result;d.value=[n.m1.prob,n.m2.prob],c.value=[n.m1.rank,n.m2.rank]}))},_=async()=>{const e=h.result,t=(t,n="m1")=>({prob:e[n].prob[t],rank:e[n].rank[t],topk:e[n].topk[t]});x.value=h.result.tokens.map(((n,o)=>{const a=i.exports.get(e,xe[f.value].access)[o];return{token:n,value:a,index:o,color:xe[f.value].colorScale(a),m1:t(o,"m1"),m2:t(o,"m2"),diff:{rank:e.diff.rank[o],rank_clamped:e.diff.rank_clamp[o],prob:e.diff.prob[o],topk:e.diff.topk[o]}}}))};a(f,(()=>{g.value=xe[f.value],_()}));const I=n({values:[],bin_edges:[]}),z=n([]);E((()=>{}));let A=[];return D((()=>{A.forEach((e=>e.destroy())),A=P("[data-tippy-content]",{trigger:"mouseenter click"})})),{allModels:l,selectedM1:s,selectedM2:r,customText:T,analyzeText:S,probValues:d,rankValues:c,scalePow:C,hoverID:u,hoverChanged:e=>{u.value=e.index,w.value=!!e.mini},states:e,availableDiffModes:m,currentDiffMode:f,currentDiffModeObject:g,tokenList:x,datasets:v,currentDataset:b,availableMetrics:Ge,currentMetric:k,currentMetricObject:y,searchForSamples:()=>{e.searchRequestSent=!0;const n=s.value,o=r.value,a=b.value,l=k.value;y.value=Ge.filter((e=>e.k===l))[0],t.findSamples(n,o,a,l).then((t=>{e.searchRequestSent=!1,I.value=t.histogram,z.value=t.result.map((e=>({text:e.text,measure:e.metrics[l]})))}))},searchHistogram:I,sampleTexts:z,useSample:e=>{T.value=e,S(),function(e){const t=document.getElementById(e);window.scrollTo(t.offsetLeft,t.offsetTop)}("Inspector")},tokenization:p,updateTokenSelection:({index:e})=>{const t=i.exports.findIndex(M.value,(t=>t.index===e));t<0?M.value=[...M.value,{index:e,currentTokenInfo:x.value[e],tokenization:p.value}].sort(((e,t)=>N(e.index,t.index))):M.value.splice(t,1)},tooltipList:M,showMiniTT:w,questionMark:X,caretUp:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" >\n<polygon points="8,20 16,10 24,20 "/>\n\x3c!--<rect class="st0" width="32" height="32"/>--\x3e\n</svg>',caretDown:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" >\n<polygon points="24,12 16,22 8,12 "/>\n\x3c!--<rect class="st0" width="32" height="32"/>--\x3e\n</svg>',rankDiffColors:Je,probDiffColors:Ke}}});const tt=y();x("data-v-3619c6bc");const nt={key:0,style:{"max-width":"800px",margin:"0 auto",padding:"15px","box-sizing":"border-box","background-color":"#eee","border-radius":"0 0 10px 10px",border:"3px solid #2c2d4d","border-top":"none",position:"relative"}},ot=f("h3",{style:{border:"none"}},"About",-1),at=f("p",null,"LMdiff allows to observe qualitative differences between language models of similar type and of the same tokenization method. For a given text, the pairwise differences in probability and rank of a token under each of the models is encoded in gradients of red (model 1) to blue (model 2). Interesting snippets can be searched in a pre-recorded corpus using a described metric. ",-1),lt=f("div",{style:{display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"space-around"}},[f("div",{style:{"background-color":"#2d2e4c",width:"100%","text-align":"center",margin:"3px",padding:"5px"}},[f("a",{href:"https://vimeo.com/640945461",style:{"font-weight":"bold",color:"#eeeeee"}},"Intro Video ")]),f("div",{style:{"background-color":"#4393c3",width:"100%","text-align":"center",margin:"3px",padding:"5px"}},[f("a",{href:"https://github.com/HendrikStrobelt/LMdiff",style:{"font-weight":"bold",color:"#eeeeee"}},"Github Repo")]),f("div",{style:{"background-color":"rgba(128,128,128,1)",width:"100%","text-align":"center",margin:"3px",padding:"5px"}},[f("a",{href:"http://arxiv.org/abs/2111.01582",style:{"font-weight":"bold",color:"#eeeeee"}},"Demo Paper*")])],-1),it=T(" *paper was accepted at EMNLP demo track 2021 and won NeurIPS best demo award 2020 "),st=f("br",null,null,-1),rt=f("p",null,[T(" LMdiff is a "),f("a",{href:"https://mitibmwatsonailab.mit.edu/"},"MIT-IBM Watson AI Lab"),T(" collaborative project by: "),f("br")],-1),dt=f("div",{style:{display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"space-around"}},[f("div",null,[f("a",{style:{color:"#000"},href:"http://hendrik.strobelt.com",target:"_blank"},"Hendrik Strobelt"),T(),f("br"),T("(IBM, MIT) ")]),f("div",null,[f("a",{style:{color:"#000"},href:"https://www.bhoov.com/",target:"_blank"},"Benjamin Hoover"),f("br"),T(" (IBM, GeorgiaTech)")]),f("div",null,[f("a",{style:{color:"#000"},href:"https://arvindsatya.com/",target:"_blank"},"Arvind Satyanarayan"),f("br"),T(" (MIT)")]),f("div",null,[f("a",{style:{color:"#000"},href:"https://sebastiangehrmann.com/",target:"_blank"},"Sebastian Gehrmann"),T(),f("br"),T("(HarvardNLP, Google)")])],-1),ct={key:0,style:{width:"100%",padding:"5px","box-sizing":"border-box","text-align":"center","background-color":"#bb1e1e",color:"white"}},ut={key:1,style:{width:"100%",padding:"5px","box-sizing":"border-box"}},pt={id:"Inspector"},ht=T(" Enter own text snippet "),mt={key:0},ft=T(" Or search for interesting snippets "),gt={key:0},vt={key:0},bt=f("div",{class:"subheading"},"Select dataset and metric",-1),kt={style:{display:"inline-block"}},yt={style:{display:"inline-block","margin-left":"1em"}},xt={style:{display:"inline-block","margin-left":"1em"}},wt={key:1},Mt={key:2},Tt={key:3,style:{"margin-top":"10px",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},St=f("div",{class:"subheading"}," Search results (click for details) ",-1),Ct={style:{display:"flex","flex-wrap":"nowrap","flex-direction":"row","align-items":"flex-end"}},_t={key:0,style:{"padding-right":"10px"}},It={style:{"overflow-y":"scroll","max-height":"150px",display:"inline-block"}},zt={class:"measureNumber"},At={style:{width:"100%",margin:"10px 0",padding:"5px",background:"#2c2d4d",color:"white"}},Dt=f("h3",null," Token Analysis ",-1),Lt={style:{"overflow-x":"auto"}},Ht={style:{"margin-top":"10px"}},Rt=f("div",{class:"subheading"},"Probabilities (larger is better)",-1),Et={style:{"margin-top":"10px"}},qt=f("div",{class:"subheading"},"Rank (smaller is better)",-1),Pt={style:{"margin-top":"10px"}},Nt=f("div",{class:"subheading"},"Measure mapped to each token",-1),$t={style:{display:"inline-block"}},Ot={style:{"margin-top":"10px"}},jt=f("div",{class:"subheading"},"Tokens (hover/click for details)",-1),Ut={style:{"margin-top":"20px"}},Bt=f("div",{class:"subheading"},"Selected Tokens",-1),Ft={key:0},Vt={key:0,style:{"margin-top":"20px"}},Wt={class:"subheading"};w();const Gt=tt(((e,t,n,o,a,l)=>{const i=L("NavBar"),s=L("MidiHistogram"),r=L("LineGraph"),d=L("InteractiveTokens"),c=L("MultiSelectTooltips"),u=L("MiniHisto");return M(),m(b,null,[f(i,{"all-models":e.allModels,"selected-m1":e.selectedM1,"onUpdate:selected-m1":t[1]||(t[1]=t=>e.selectedM1=t),"selected-m2":e.selectedM2,"onUpdate:selected-m2":t[2]||(t[2]=t=>e.selectedM2=t),onAboutClicked:t[3]||(t[3]=t=>e.states.showAbout=!e.states.showAbout)},null,8,["all-models","selected-m1","selected-m2"]),f($,{name:"fade"},{default:tt((()=>[e.states.showAbout?(M(),m("div",nt,[ot,at,lt,it,st,rt,dt,f("p",{style:{padding:"2px",cursor:"pointer","text-align":"center"},onClick:t[4]||(t[4]=t=>e.states.showAbout=!1)},"[close] ")])):z("",!0)])),_:1}),e.states.modelsMatch?(M(),m("div",ut,[f("h3",pt,[(M(),m("svg",{class:"question-icon",innerHTML:e.states.showEnter?e.caretUp:e.caretDown,onClick:t[5]||(t[5]=t=>e.states.showEnter=!e.states.showEnter)},null,8,["innerHTML"])),ht,f("span",null,[(M(),m("svg",{"data-tippy-content":"Enter your own text",class:"question-icon",innerHTML:e.questionMark},null,8,["innerHTML"]))])]),f($,{name:"fade2"},{default:tt((()=>[e.states.showEnter?(M(),m("div",mt,[g(f("textarea",{id:"test_text",style:{width:"100%","box-sizing":"border-box",border:"1px solid lightgray",height:"50px",font:"inherit"},"onUpdate:modelValue":t[6]||(t[6]=t=>e.customText=t)},null,512),[[O,e.customText]]),f("button",{onClick:t[7]||(t[7]=(...t)=>e.analyzeText&&e.analyzeText(...t)),disabled:e.states.analyzeRequestSent,style:{margin:"10px 0"}}," analyze text ",8,["disabled"])])):z("",!0)])),_:1}),f("h3",null,[(M(),m("svg",{class:"question-icon",innerHTML:e.states.showSearch?e.caretUp:e.caretDown,onClick:t[8]||(t[8]=t=>e.states.showSearch=!e.states.showSearch)},null,8,["innerHTML"])),ft,(M(),m("svg",{"data-tippy-content":"Search for interesting text snippets in pre-analyzed datasets\n      using a summary diff measure (like, e.g., average rank diff) per snippet.",class:"question-icon",innerHTML:e.questionMark},null,8,["innerHTML"]))]),f($,{name:"fade2"},{default:tt((()=>[e.states.showSearch?(M(),m("div",gt,[e.datasets.length>0?(M(),m("div",vt,[bt,f("div",kt,[g(f("select",{name:"dataset",id:"ds-select","onUpdate:modelValue":t[9]||(t[9]=t=>e.currentDataset=t),style:{"background-color":"#eee"}},[(M(!0),m(b,null,k(e.datasets,(e=>(M(),m("option",{key:e,value:e},S(e),9,["value"])))),128))],512),[[j,e.currentDataset]])]),f("div",yt,[g(f("select",{name:"dataset",id:"metric-select","onUpdate:modelValue":t[10]||(t[10]=t=>e.currentMetric=t),style:{"background-color":"#eee"}},[(M(!0),m(b,null,k(e.availableMetrics,(e=>(M(),m("option",{key:e.k,value:e.k},S(e.d),9,["value"])))),128))],512),[[j,e.currentMetric]])]),f("div",xt,[f("button",{disabled:!e.currentDataset.length||e.states.searchRequestSent,onClick:t[11]||(t[11]=(...t)=>e.searchForSamples&&e.searchForSamples(...t))}," search ",8,["disabled"])])])):(M(),m("div",wt," Argh... no snippet dataset available for the current selection of models. ")),e.states.searchRequestSent?(M(),m("div",Mt," Searching ....")):z("",!0),e.sampleTexts.length>0?(M(),m("div",Tt,[St,f("div",Ct,["topk"!==e.currentMetricObject.t?(M(),m("div",_t,[f(s,{values:e.searchHistogram.values,"bin-edges":e.searchHistogram.bin_edges,"color-scheme":"rank"===e.currentMetricObject.t?e.rankDiffColors:e.probDiffColors,height:150,width:300,"used-values":e.sampleTexts.map((e=>e.measure))},null,8,["values","bin-edges","color-scheme","used-values"])])):z("",!0),f("div",It,[(M(!0),m(b,null,k(e.sampleTexts,(t=>(M(),m("div",{class:"sampleText",key:(e,t)=>e.text+t,onClick:n=>e.useSample(t.text),style:{borderLeftColor:"rank"===e.currentMetricObject.t?e.rankDiffColors[Math.sign(t.measure)+1]:"prob"===e.currentMetricObject.t?e.probDiffColors[Math.sign(t.measure)+1]:""}},[T(S(t.text)+" ",1),f("span",zt," ("+S(t.measure)+")",1)],12,["onClick"])))),128))])])])):z("",!0)])):z("",!0)])),_:1}),g(f("div",At," Request sent and processing ..... ",512),[[v,e.states.analyzeRequestSent]]),g(f("div",null,[Dt,f("div",Lt,[f("div",Ht,[Rt,f(r,{values:e.probValues,onHoverChanged:e.hoverChanged,"show-hover-for":e.hoverID},null,8,["values","onHoverChanged","show-hover-for"])]),f("div",Et,[qt,f(r,{values:e.rankValues,"max-value":2e3,"y-scale":e.scalePow().exponent(.3).clamp(!0),onHoverChanged:e.hoverChanged,"show-hover-for":e.hoverID},null,8,["values","y-scale","onHoverChanged","show-hover-for"])])]),f("div",Pt,[Nt,f("div",$t,[(M(!0),m(b,null,k(e.availableDiffModes,(t=>(M(),m("button",{class:["diffMode",{selected:t.key===e.currentDiffMode}],key:t.key,onClick:n=>e.currentDiffMode=t.key,"data-tippy-content":t.description,"data-tippy-trigger":"mouseenter"},S(t.name),11,["onClick","data-tippy-content"])))),128))])]),f("div",Ot,[jt,f(d,{tokens:e.tokenList,tokenization:e.tokenization,onHoverChanged:e.hoverChanged,onTokenClicked:e.updateTokenSelection,"are-selected":e.tooltipList.map((e=>e.index)),"show-hover-for":e.hoverID,showMiniTT:e.showMiniTT},null,8,["tokens","tokenization","onHoverChanged","onTokenClicked","are-selected","show-hover-for","showMiniTT"])]),f("div",Ut,[Bt,0===e.tooltipList.length?(M(),m("div",Ft," (Click on tokens to select some.) ")):(M(),m(c,{key:1,"tooltip-list":e.tooltipList,onCloseTT:e.updateTokenSelection,onHoverChanged:e.hoverChanged,"show-hover-for":e.hoverID},null,8,["tooltip-list","onCloseTT","onHoverChanged","show-hover-for"]))]),e.currentDiffMode.indexOf("diff")>-1?(M(),m("div",Vt,[f("div",Wt,"Token Statistics for "+S(e.currentDiffModeObject.name),1),f(u,{height:150,width:250,"data-points":e.tokenList.map((e=>e.value)),"color-scheme":e.currentDiffMode.indexOf("rank")>-1?e.rankDiffColors:e.probDiffColors},null,8,["data-points","color-scheme"])])):z("",!0)],512),[[v,!e.states.zeroRequests&&!e.states.analyzeRequestSent]])])):(M(),m("div",ct," -- Please choose compatible models -- "))],64)}));et.render=Gt,et.__scopeId="data-v-3619c6bc",U(et).mount("#app");
